#!/bin/bash

set -e -o pipefail

docs="

Available commands: 

  init [host]
  push
  up
  status

"

cd -- "$HOME"

case "$1" in
    init)
	echo "Initializing $2"
	git remote add "host/$2" "ssh://$2/~/"
	ssh -- "$2" "git init-db"
	git push "host/$2" master
	ssh -- "$2" "git branch local && git checkout local"

	;;

    push)
	for remote in `git remote`; do
	    host=`echo $remote | sed 's/^host\///'`
	    echo "Pushing to $host"
	    git push "$remote" master
	    ssh -- "$host" "git checkout local && git rebase master"
	    echo
	done

	;;

    up)
	git checkout local
	git rebase master

	;;

    status|st)
	git status -uno

	;;

    *)
	echo "$docs"
	
	;;
esac